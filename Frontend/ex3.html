<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Onboarding Form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
            /* display: flex; */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            line-height: 1.6;
        }

        .consent-section {
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .consent-text {
            font-size: 0.9rem;
            color: #495057;
            margin-bottom: 10px;
        }

        #consentCheckbox {
            margin-right: 5px;
        }

        .consent-label {
            display: inline-flex;
            align-items: center;
            font-weight: 500;
        }

        .hidden-scroll {
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .hidden-scroll::-webkit-scrollbar {
            display: none;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            background-color: white;
            /* border-radius: 12px; */
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            box-shadow: 0 10px 35px rgba(0,0,0,0.08);
            padding: 3rem;
            position: relative;
        }

        .A {
            text-align: center;
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            padding: 2rem;
            /* margin-top: -3rem; */
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .error-message {
            color: red;
            font-size: 0.8rem;
            margin-top: 5px;
            display: block;
        }

        input.is-invalid, 
        textarea.is-invalid, 
        select.is-invalid {
            border-color: red;
            box-shadow: 0 0 0 0.2rem rgba(255, 0, 0, 0.25);
        }

        img {
            height: 80px;
            width: 140px;
            border-radius: 43%;
        }

        h1 {
            color: #ffffff;
            text-shadow: 2px 2px 6px #b3b3b3;
            font-weight: 600;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .form-label {
            font-weight: 500;
            color: #495057;
            font-size: 0.95rem;
        }

        .form-section:has(input[name="aadharNo"]) .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-section .form-group:has(#employmentStatus) {
            max-width: 100%;
            margin-bottom: 1.5rem;
        }

        .form-section .form-group:has(#employmentStatus) select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            color: #495057;
        }

        .form-section .form-group:has(#employmentStatus) select:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .form-section .form-group:has(#employmentStatus) select.is-invalid {
            border-color: red;
            box-shadow: 0 0 0 0.2rem rgba(255, 0, 0, 0.25);
        }

        .id-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .id-container input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .file-upload-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .file-upload-container input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            background-color: white;
        }

        .file-format-info {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .preview-container {
            min-height: 100px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: white;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .form-section:has(input[name="aadharNo"]) .form-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        .remove-employment, .remove-education {
            width: 30%;
        }

        .form-section {
            margin-top: 30px;
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            align-items: center;
            margin-top: 30px;
        }

        .form-grid > * {
            display: flex;
            flex-direction: column;
        }

        .form-grid input, 
        .form-grid select, 
        .form-grid textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        textarea {
            resize: none;
            height: 51px;
        }

        .form-grid label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #495057;
        }

        textarea[name="currentAddress"],
        textarea[name="permanentAddress"] {
            grid-column: 1 / -1;
        }

        #sameAsCurrentAddress {
            margin-right: 0.5rem;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .button-group {
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-top: 30px;
        }

        #addEducationBtn, 
        #addEmploymentBtn {
            margin-top: 1rem;
            width: 100%;
            padding: 0.75rem;
            background-color: blue;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #addEducationBtn:hover, 
        #addEmploymentBtn:hover {
            background-color: rgb(111, 111, 255);
        }

        input[type="file"] {
            border: 2px dashed #dee2e6;
            padding: 0.5rem;
        }

        #notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 0.25rem;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="A">
        <h1>EMPLOYEE ONBOARDING FORM</h1>
    </div>
    <div class="container">
        <!-- <hr> -->
        <div id="notification"></div>
        <form id="onboardingForm" enctype="multipart/form-data">
            <!-- Personal Information Section -->
            <div class="form-section">
                <h2>Personal Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="fullName">Full Name <span style="color: red;">*</span></label>
                        <input type="text" id="fullName" name="fullName" placeholder="Full Name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="email">Email ID <span style="color: red;">*</span></label>
                        <input type="email" id="email" name="email" placeholder="Email ID" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="phoneNo">Phone Number <span style="color: red;">*</span></label>
                        <input type="tel" id="phoneNo" name="phoneNo" placeholder="Phone Number" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="alternateNumber">Alternate Number</label>
                        <input type="tel" id="alternateNumber" name="alternateNumber" placeholder="Alternate Number">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="guardianName">Guardian Name</label>
                        <input type="text" id="guardianName" name="guardianName" placeholder="Guardian Name">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="guardianContact">Guardian Contact Number</label>
                        <input type="tel" id="guardianContact" name="guardianContact" placeholder="Guardian Contact Number">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="maritalStatus">Marital Status <span style="color: red;">*</span></label>
                        <select id="maritalStatus" name="maritalStatus" required>
                            <option value="">Select Status</option>
                            <option value="single">Single</option>
                            <option value="married">Married</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="gender">Gender <span style="color: red;">*</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="bloodGroup">Blood Group <span style="color: red;">*</span></label>
                        <select id="bloodGroup" name="bloodGroup" required>
                            <option value="">Select Blood Group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dateOfBirth">Date of Birth <span style="color: red;">*</span></label>
                        <input type="date" id="dateOfBirth" name="dateOfBirth" min="1970-01-01" required>
                    </div>
                </div>
            </div>

            <!-- Government ID Section -->
            <div class="form-section">
                <h2>Government Proof IDs</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="aadharNo">Aadhar Number <span style="color: red;">*</span></label>
                        <input type="text" id="aadharNo" name="aadharNo" placeholder="Enter Your Aadhar Number" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="margin-top: 25px;" for="aadhaarFile">Aadhar Card Document <span style="color: red;">*</span></label>
                        <input type="file" id="aadhaarFile" name="aadhaarFile" required accept=".pdf,.jpg,.jpeg,.png">
                        <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="panNo">PAN Number <span style="color: red;">*</span></label>
                        <input type="text" id="panNo" name="panNo" placeholder="Enter Your Pan Number" required maxlength="10">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="margin-top: 25px;" for="panFile">PAN Card Document <span style="color: red;">*</span></label>
                        <input type="file" id="panFile" name="panFile" required accept=".pdf,.jpg,.jpeg,.png">
                        <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="pfNo">PF Number (Previous Company)</label>
                        <input type="text" id="pfNo" name="pfNo" placeholder="Enter Your PF Number">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="uanNo">UAN Number</label>
                        <input type="text" id="uanNo" name="uanNo" placeholder="Enter Your UAN Number">
                    </div>
                </div>
            </div>

            <!-- Address Section -->
            <div class="form-section">
                <h2>Address Details</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label" for="currentAddress">Current Address <span style="color: red;">*</span></label>
                        <textarea id="currentAddress" name="currentAddress" class="hidden-scroll" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentCity">Current City <span style="color: red;">*</span></label>
                        <input type="text" id="currentCity" name="currentCity" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentState">Current State <span style="color: red;">*</span></label>
                        <input type="text" id="currentState" name="currentState" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentPincode">Current Pincode <span style="color: red;">*</span></label>
                        <input type="text" id="currentPincode" name="currentPincode" required>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="sameAsCurrentAddress" name="sameAsCurrentAddress">
                    <label for="sameAsCurrentAddress">Permanent Address same as Current Address</label>
                </div>

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label" for="permanentAddress">Permanent Address <span style="color: red;">*</span></label>
                        <textarea id="permanentAddress" name="permanentAddress" class="hidden-scroll" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="permanentCity">Permanent City <span style="color: red;">*</span></label>
                        <input type="text" id="permanentCity" name="permanentCity" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="permanentState">Permanent State <span style="color: red;">*</span></label>
                        <input type="text" id="permanentState" name="permanentState" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="permanentPincode">Permanent Pincode <span style="color: red;">*</span></label>
                        <input type="text" id="permanentPincode" name="permanentPincode" required>
                    </div>
                </div>
            </div>

            <!-- Bank Details -->
            <div class="form-section">
                <h2>Bank Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="bankNameAsPerForm">Account Holder Name <span style="color: red;">*</span></label>
                        <input type="text" id="bankNameAsPerForm" name="bankNameAsPerForm" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="accountNo">Account Number <span style="color: red;">*</span></label>
                        <input type="text" id="accountNo" name="accountNo" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="ifscCode">IFSC Code <span style="color: red;">*</span></label>
                        <input type="text" id="ifscCode" name="ifscCode" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="branchName">Branch Name <span style="color: red;">*</span></label>
                        <input type="text" id="branchName" name="branchName" required>
                    </div>
                </div>
            </div>

            <!-- Education Details -->
            <div class="form-section">
                <h2>Education Details</h2>
                <div id="educationContainer">
                    <div class="form-grid education-row">
                        <div class="form-group">
                            <label class="form-label" for="education[0][level]">Education Level <span style="color: red;">*</span></label>
                            <select id="education[0][level]" name="education[0][level]" required>
                                <option value="">Select Level</option>
                                <option value="High School">High School</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Bachelor's">Bachelor's</option>
                                <option value="Master's">Master's</option>
                                <option value="Doctorate">Doctorate</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="education[0][stream]">Stream <span style="color: red;">*</span></label>
                            <input type="text" id="education[0][stream]" name="education[0][stream]" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="education[0][institution]">Institution Name <span style="color: red;">*</span></label>
                            <input type="text" id="education[0][institution]" name="education[0][institution]" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="education[0][year]">Graduation Year <span style="color: red;">*</span></label>
                            <input type="text" id="education[0][year]" name="education[0][year]" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="education[0][score]">Percentage/CGPA <span style="color: red;">*</span></label>
                            <input type="text" id="education[0][score]" name="education[0][score]" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="education[0][doc]">Education Document</label>
                            <input type="file" id="education[0][doc]" name="educationDocs" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
                    </div>
                </div>
                <button type="button" id="addEducationBtn" class="btn btn-primary">Add Education</button>
            </div>

            <!-- Employment Status Dropdown -->
            <div class="form-section">
                <div class="form-group">
                    <label class="form-label" for="employmentStatus">Employment Status <span style="color: red;">*</span></label>
                    <select id="employmentStatus" name="employmentStatus" required>
                        <option value="">Select Status</option>
                        <option value="fresher">Fresher</option>
                        <option value="experienced">Experienced</option>
                    </select>
                </div>
            </div>

            <!-- Employment History (Initially Hidden) -->
            <div class="form-section" id="employmentHistorySection" style="display: none;">
                <h2>Employment History</h2>
                <div id="employmentHistory">
                    <div class="form-grid employment-row">
                        <div class="form-group">
                            <label class="form-label" for="employment[0][companyName]">Company Name</label>
                            <input type="text" id="employment[0][companyName]" name="employment[0][companyName]">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="employment[0][designation]">Designation/Role</label>
                            <input type="text" id="employment[0][designation]" name="employment[0][designation]">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="employment[0][lastProject]">Last Project Name</label>
                            <input type="text" id="employment[0][lastProject]" name="employment[0][lastProject]">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="employment[0][companyStartDate]">Start Date</label>
                            <input type="date" id="employment[0][companyStartDate]" name="employment[0][companyStartDate]" min="1970-01-01">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="employment[0][companyEndDate]">End Date</label>
                            <input type="date" id="employment[0][companyEndDate]" name="employment[0][companyEndDate]" min="1970-01-01">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="employment[0][employmentDoc]">Experience Certificate</label>
                            <input type="file" id="employment[0][employmentDoc]" name="employmentDocs" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
                    </div>
                </div>
                <button type="button" id="addEmploymentBtn" class="btn btn-primary">Add Employment</button>
            </div>

            <!-- Signature -->
            <div class="form-section">
                <h2>Signature and Consent</h2>
                <div class="form-group">
                    <label class="form-label" for="signatureFile">Upload Signature <span style="color: red;">*</span></label>
                    <input type="file" id="signatureFile" name="signatureFile" accept=".jpg,.jpeg,.png" required>
                    <div class="file-format-info">Accepted formats: JPG, PNG (Max size: 2MB)</div>
                </div>

                <div class="consent-section">
                    <div class="consent-text">
                        I hereby confirm that the information provided in this onboarding form is accurate, complete, and true to the best of my knowledge. I understand that any false or incomplete information may result in the rejection of my application or termination of employment.
                    </div>
                    <div class="form-group" style="display: inline-block;">
                        <input type="checkbox" id="consentCheckbox" name="consentCheckbox" required>
                        <label for="consentCheckbox" class="consent-label">
                            I agree to the above terms and provide my consent <span class="required">*</span>
                        </label>
                    </div>                    
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">Submit Onboarding Form</button>
                </div>
            </div>
        </form>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    const notification = document.getElementById('notification');

    // Notification System
    function showNotification(message, type) {
        notification.textContent = message;
        notification.style.backgroundColor = type === 'success' ? '#10b981' : '#ef4444';
        notification.style.color = 'white';
        notification.style.display = 'block';
        setTimeout(() => notification.style.display = 'none', type === 'success' ? 10000 : 3000);
    }

    const validations = {
        validateAlphabeticField: function(value, minLength = 5, maxLength = 50) {
            const cleanValue = value.replace(/\s/g, '');
            const alphabeticWithSpacesRegex = /^[a-zA-Z\s]+$/;
            return alphabeticWithSpacesRegex.test(value) && 
                   cleanValue.length >= minLength && 
                   cleanValue.length <= maxLength &&
                   value.trim().length > 0;
        },

        validateEmail: function(value) {
            const emailRegex = /^[a-zA-Z0-9](?:[a-zA-Z0-9\-_.]*[a-zA-Z0-9])?@(gmail|outlook)\.com$/;
            const atCount = (value.match(/@/g) || []).length;
            if (atCount !== 1) {
                return false;
            }
            const localPart = value.split('@')[0] || '';
            const domainPart = value.split('@')[1] || '';
            const alphabeticCount = (localPart.match(/[a-zA-Z]/g) || []).length;
            const validDomains = ['gmail.com', 'outlook.com'];
            const hasConsecutiveSpecialChars = /[\-_\.]{2}/.test(localPart);
            return emailRegex.test(value) && 
                   !/\s/.test(value) && 
                   validDomains.includes(domainPart) && 
                   value.endsWith('.com') && 
                   alphabeticCount >= 5 && 
                   !hasConsecutiveSpecialChars;
        },

        validatePhoneNumber: function(value) {
            const phoneRegex = /^[6-9]\d{9}$/;
            return phoneRegex.test(value) && value.length === 10;
        },

        validateAadharNumber: function(value) {
            const aadharRegex = /^[1-9]\d{11}$/;
            return aadharRegex.test(value) && value.length === 12;
        },

        validatePANNumber: function(value) {
            const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
            return panRegex.test(value) && value.length === 10 && !/\s/.test(value);
        },

        validatePFNumber: function(value) {
            if (!value) return true;
            const pfRegex = /^[A-Z]{5}\d{8,17}$/;
            const digits = value.slice(5);
            const hasNonZero = digits && /[1-9]/.test(digits);
            return pfRegex.test(value) && 
                   value.length >= 13 && 
                   value.length <= 22 && 
                   hasNonZero && 
                   !/\s/.test(value);
        },

        validateUANNumber: function(value) {
            if (!value) return true;
            const uanRegex = /^1\d{11}$/;
            return uanRegex.test(value) && value.length === 12;
        },

        validateAddress: function(value) {
            const cleanValue = value.replace(/\s/g, '');
            const trimmedValue = value.trim();
            const words = trimmedValue.split(/\s+/);
            const alphaCount = (cleanValue.match(/[a-zA-Z]/g) || []).length;
            const hasSingleCharWords = words.some(word => word.length === 1);
            const hasMultipleSpaces = /\s{2,}/.test(value);
            return trimmedValue.length > 0 &&
                   alphaCount >= 5 &&
                   cleanValue.length <= 100 &&
                   !hasSingleCharWords &&
                   !hasMultipleSpaces;
        },

        validatePincode: function(value) {
            const pincodeRegex = /^[1-9][0-9]{5}$/;
            return pincodeRegex.test(value) && value.length === 6;
        },

        validateAccountNumber: function(value) {
            const accountRegex = /^\d{8,18}$/;
            const hasNonZero = /[1-9]/.test(value);
            return accountRegex.test(value) && hasNonZero;
        },
        
        validateIFSCCode: function(value) {
            const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;
            return ifscRegex.test(value) && value.trim().length === 11;
        },

        validateGraduationYear: function(value, dateOfBirth) {
            const yearRegex = /^\d{4}$/;
            const year = parseInt(value);
            const birthYear = dateOfBirth ? new Date(dateOfBirth).getFullYear() : 1970;
            return yearRegex.test(value) && 
                   year >= (birthYear + 10) && 
                   year <= new Date().getFullYear();
        },

        validatePercentage: function(value) {
    const percentageRegex = /^(100(\.00?)?|[1-9]?[0-9](\.[0-9]{1,2})?)$/;
    const numericValue = parseFloat(value);
    return percentageRegex.test(value) && numericValue >= 1 && numericValue <= 100;
},

        validateAge: function(dateOfBirth) {
            const today = new Date();
            const birthDate = new Date(dateOfBirth);
            const minYear = 1970;
            const maxDate = new Date(today);
            maxDate.setFullYear(today.getFullYear() - 21);
            if (birthDate.getFullYear() < minYear || birthDate > maxDate) {
                return false;
            }
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age >= 21;
        },

        validateDateNotFuture: function(date) {
            const inputDate = new Date(date);
            const today = new Date();
            return inputDate <= today;
        },

        validateEmploymentDateRange: function(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const today = new Date();
            const minDate = new Date('1970-01-01');
            if (start < minDate || start > today) {
                return { valid: false, message: 'Start date must be between 1970 and today' };
            }
            if (end < minDate || end > today) {
                return { valid: false, message: 'End date must be between 1970 and today' };
            }
            if (end <= start) {
                return { valid: false, message: 'End date must be after start date' };
            }
            const threeMonthsLater = new Date(start);
            threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 2);
            if (end < threeMonthsLater) {
                return { valid: false, message: 'Minimum 2 months gap required between start and end dates' };
            }
            return { valid: true };
        },
        
        validateDifferentPhone: function(phone1, phone2) {
            return phone1 !== phone2 || phone1 === '';
        }
    };

    function showError(element, message) {
        const existingError = element.parentNode.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        const errorElement = document.createElement('div');
        errorElement.className = 'error-message text-danger';
        errorElement.style.color = 'red';
        errorElement.style.fontSize = '0.8rem';
        errorElement.textContent = message;
        element.parentNode.appendChild(errorElement);
        element.classList.add('is-invalid');
    }

    function removeError(element) {
        const existingError = element.parentNode.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        element.classList.remove('is-invalid');
    }

    function validateGraduationYears() {
        let isValid = true;
        const educationContainer = document.getElementById('educationContainer');
        const educationRows = educationContainer.querySelectorAll('.education-row');
        const educationData = [];
        const levelOrder = {
            'High School': 1,
            'Intermediate': 2,
            "Bachelor's": 3,
            "Master's": 4,
            'Doctorate': 5
        };
        educationRows.forEach((row, index) => {
            const levelSelect = row.querySelector(`select[name="education[${index}][level]"]`);
            const yearInput = row.querySelector(`input[name="education[${index}][year]"]`);
            if (levelSelect.value && yearInput.value) {
                educationData.push({
                    index,
                    level: levelSelect.value,
                    year: parseInt(yearInput.value),
                    yearInput
                });
            }
        });
        educationData.sort((a, b) => levelOrder[a.level] - levelOrder[b.level]);
        for (let i = 1; i < educationData.length; i++) {
            const current = educationData[i];
            const previous = educationData[i - 1];
            if (current.year <= previous.year) {
                isValid = false;
                showError(
                    current.yearInput,
                    `${current.level} graduation year must be greater than ${previous.level} year (${previous.year})`
                );
            } else {
                removeError(current.yearInput);
            }
        }
        return isValid;
    }

    function setupAddressSynchronization() {
        const sameAsCurrentAddressCheckbox = document.getElementById('sameAsCurrentAddress');
        const permanentAddressFields = [
            { element: document.querySelector('label[for="permanentAddress"]'), selector: 'label' },
            { element: document.querySelector('textarea[name="permanentAddress"]'), selector: 'textarea' },
            { element: document.querySelector('label[for="permanentCity"]'), selector: 'label' },
            { element: document.querySelector('input[name="permanentCity"]'), selector: 'input' },
            { element: document.querySelector('label[for="permanentState"]'), selector: 'label' },
            { element: document.querySelector('input[name="permanentState"]'), selector: 'input' },
            { element: document.querySelector('label[for="permanentPincode"]'), selector: 'label' },
            { element: document.querySelector('input[name="permanentPincode"]'), selector: 'input' }
        ];
        const originalPermanentDetails = {
            address: document.querySelector('textarea[name="permanentAddress"]').value,
            city: document.querySelector('input[name="permanentCity"]').value,
            state: document.querySelector('input[name="permanentState"]').value,
            pincode: document.querySelector('input[name="permanentPincode"]').value,
            visibility: permanentAddressFields.map(field => ({
                element: field.element,
                display: field.element ? field.element.style.display : 'block'
            }))
        };
        sameAsCurrentAddressCheckbox.addEventListener('change', function() {
            if (this.checked) {
                permanentAddressFields.forEach(field => {
                    if (field.element) {
                        const formGroup = field.element.closest('.form-group');
                        if (formGroup) {
                            formGroup.style.display = 'none';
                        }
                    }
                });
                document.querySelector('textarea[name="permanentAddress"]').value = 
                    document.querySelector('textarea[name="currentAddress"]').value;
                document.querySelector('input[name="permanentCity"]').value = 
                    document.querySelector('input[name="currentCity"]').value;
                document.querySelector('input[name="permanentState"]').value = 
                    document.querySelector('input[name="currentState"]').value;
                document.querySelector('input[name="permanentPincode"]').value = 
                    document.querySelector('input[name="currentPincode"]').value;
            } else {
                permanentAddressFields.forEach(field => {
                    if (field.element) {
                        const formGroup = field.element.closest('.form-group');
                        if (formGroup) {
                            formGroup.style.display = 'block';
                        }
                    }
                });
                document.querySelector('textarea[name="permanentAddress"]').value = 
                    originalPermanentDetails.address;
                document.querySelector('input[name="permanentCity"]').value = 
                    originalPermanentDetails.city;
                document.querySelector('input[name="permanentState"]').value = 
                    originalPermanentDetails.state;
                document.querySelector('input[name="permanentPincode"]').value = 
                    originalPermanentDetails.pincode;
            }
        });
    }

    function setupEducationSection() {
    const addEducationBtn = document.getElementById('addEducationBtn');
    const educationContainer = document.getElementById('educationContainer');
    let educationCounter = 1;
    const maxEducationEntries = 5;
    const allEducationLevels = [
        'High School',
        'Intermediate',
        "Bachelor's",
        "Master's",
        'Doctorate'
    ];

    function getSelectedEducationLevels() {
        const selectedLevels = [];
        const levelSelects = educationContainer.querySelectorAll('select[name$="[level]"]');
        levelSelects.forEach(select => {
            if (select.value) {
                selectedLevels.push(select.value);
            }
        });
        return selectedLevels;
    }

    function updateEducationLevelOptions(selectElement, excludedLevels) {
        selectElement.innerHTML = '<option value="">Select Level</option>';
        allEducationLevels.forEach(level => {
            if (!excludedLevels.includes(level)) {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                selectElement.appendChild(option);
            }
        });
    }

    function updateAllEducationSelects() {
        const selectedLevels = getSelectedEducationLevels();
        const levelSelects = educationContainer.querySelectorAll('select[name$="[level]"]');
        levelSelects.forEach(select => {
            const currentValue = select.value;
            updateEducationLevelOptions(select, selectedLevels.filter(level => level !== currentValue));
            select.value = currentValue;
        });
    }

    function checkEducationLimit() {
        const educationRows = educationContainer.querySelectorAll('.education-row');
        if (educationRows.length >= maxEducationEntries) {
            addEducationBtn.style.display = 'none';
        } else {
            addEducationBtn.style.display = 'block';
        }
    }

    addEducationBtn.addEventListener('click', function() {
        const selectedLevels = getSelectedEducationLevels();
        if (selectedLevels.length >= allEducationLevels.length) {
            showNotification('All education levels have been added', 'error');
            return;
        }
        const educationRows = educationContainer.querySelectorAll('.education-row');
        if (educationRows.length >= maxEducationEntries) {
            showNotification('Maximum 5 education entries allowed', 'error');
            return;
        }
        const newEducationRow = document.createElement('div');
        newEducationRow.classList.add('form-grid', 'education-row', 'mt-4');
        newEducationRow.innerHTML = `
            <div class="form-group">
                <label class="form-label">Education Level</label>
                <select name="education[${educationCounter}][level]" required>
                    <option value="">Select Level</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Stream</label>
                <input type="text" name="education[${educationCounter}][stream]" placeholder="Stream Name" required>
            </div>
            <div class="form-group">
                <label class="form-label">Institution Name</label>
                <input type="text" name="education[${educationCounter}][institution]" placeholder="Institution Name" required>
            </div>
            <div class="form-group">
                <label class="form-label">Graduation Year</label>
                <input type="text" name="education[${educationCounter}][year]" placeholder="Graduation Year" required>
            </div>
            <div class="form-group">
                <label class="form-label">Percentage/CGPA</label>
                <input type="text" name="education[${educationCounter}][score]" placeholder="Percentage" required>
            </div>
            <div class="form-group">
                <label class="form-label">Education Document</label>
                <input type="file" name="educationDocs" accept=".pdf,.jpg,.jpeg,.png">
            </div>
            <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
            <div class="form-group">
                <button type="button" class="remove-education btn btn-danger w-50 mt-4">Remove</button>
            </div>
        `;
        educationContainer.appendChild(newEducationRow);
        const newLevelSelect = newEducationRow.querySelector(`select[name="education[${educationCounter}][level]"]`);
        updateEducationLevelOptions(newLevelSelect, selectedLevels);
        const newInputs = newEducationRow.querySelectorAll('input, select');
        newInputs.forEach(input => {
            if (input.name.includes('[stream]') || input.name.includes('[institution]')) {
                input.setAttribute('maxlength', '50');
                input.addEventListener('input', function(e) {
                    let value = e.target.value
                        .replace(/[^a-zA-Z\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trimStart();
                    const cleanValue = value.replace(/\s/g, '');
                    if (cleanValue.length > 50) {
                        let validValue = '';
                        let count = 0;
                        for (let char of value) {
                            if (char !== ' ' && count >= 50) continue;
                            if (char !== ' ') count++;
                            validValue += char;
                        }
                        e.target.value = validValue;
                    } else {
                        e.target.value = value;
                    }
                    validateFormField(this);
                });
            } else if (input.name.includes('[year]')) {
                input.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
                    validateFormField(this);
                    validateGraduationYears();
                });
            } else if (input.name.includes('[score]')) {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9.]/g, '');
                    const parts = value.split('.');
                    if (parts.length > 2) {
                        value = parts[0] + '.' + parts[1];
                    }
                    if (parts[0].length > 3) {
                        parts[0] = parts[0].slice(0, 3);
                        value = parts[0] + (parts[1] ? '.' + parts[1] : '');
                    }
                    if (parseInt(parts[0]) > 100) {
                        parts[0] = '100';
                        value = parts[0] + (parts[1] ? '.' + parts[1] : '');
                    }
                    if (parts[1] && parts[1].length > 2) {
                        value = parts[0] + '.' + parts[1].slice(0, 2);
                    }
                    if (parts[0] === '' && parts[1]) {
                        value = '0.' + parts[1];
                    }
                    e.target.value = value;
                    validateFormField(this);
                });
            } else if (input.name.includes('[level]')) {
                input.addEventListener('change', function() {
                    updateAllEducationSelects();
                    validateFormField(this);
                    validateGraduationYears();
                });
            } else {
                input.addEventListener('input', function() {
                    validateFormField(this);
                });
            }
        });
        newEducationRow.querySelector('.remove-education').addEventListener('click', function() {
            newEducationRow.remove();
            updateAllEducationSelects();
            validateGraduationYears();
            checkEducationLimit();
        });
        educationCounter++;
        checkEducationLimit();
    });

    const initialLevelSelect = educationContainer.querySelector('select[name="education[0][level]"]');
    initialLevelSelect.addEventListener('change', function() {
        updateAllEducationSelects();
        validateFormField(this);
        validateGraduationYears();
    });

    const initialYearInput = educationContainer.querySelector('input[name="education[0][year]"]');
    initialYearInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
        validateFormField(this);
        validateGraduationYears();
    });

    const initialEducationInputs = educationContainer.querySelectorAll('input[name$="[stream]"], input[name$="[institution]"]');
    initialEducationInputs.forEach(input => {
        input.setAttribute('maxlength', '50');
        input.addEventListener('input', function(e) {
            let value = e.target.value
                .replace(/[^a-zA-Z\s]/g, '')
                .replace(/\s+/g, ' ')
                .trimStart();
            const cleanValue = value.replace(/\s/g, '');
            if (cleanValue.length > 50) {
                let validValue = '';
                let count = 0;
                for (let char of value) {
                    if (char !== ' ' && count >= 50) continue;
                    if (char !== ' ') count++;
                    validValue += char;
                }
                e.target.value = validValue;
            } else {
                e.target.value = value;
            }
            validateFormField(this);
        });
    });

    checkEducationLimit();
}

    function validateEmploymentDates(startDateInput, endDateInput) {
        if (!startDateInput.value && !endDateInput.value) {
            removeError(startDateInput);
            removeError(endDateInput);
            return true;
        }
        removeError(startDateInput);
        removeError(endDateInput);
        const dateOfBirth = document.querySelector('input[name="dateOfBirth"]').value;
        let minStartDate;
        if (dateOfBirth) {
            const birthDate = new Date(dateOfBirth);
            minStartDate = new Date(birthDate);
            minStartDate.setFullYear(birthDate.getFullYear() + 10);
        } else {
            minStartDate = new Date('1970-01-01');
        }
        const today = new Date();
        const maxStartDate = new Date(today);
        maxStartDate.setMonth(today.getMonth() - 3);
        if (startDateInput.value) {
            const startDate = new Date(startDateInput.value);
            if (startDate < minStartDate) {
                showError(startDateInput, `Start date must be at least 10 years after your date of birth (${minStartDate.toISOString().split('T')[0]})`);
                return false;
            }
            if (startDate > maxStartDate) {
                showError(startDateInput, 'Start date cannot be more recent than 3 months before today');
                return false;
            }
            if (startDate < new Date('1970-01-01')) {
                showError(startDateInput, 'Start date cannot be before 1970');
                return false;
            }
        }
        if (endDateInput.value) {
            const endDate = new Date(endDateInput.value);
            if (endDate > today) {
                showError(endDateInput, 'End date cannot be in the future');
                return false;
            }
            if (endDate < new Date('1970-01-01')) {
                showError(endDateInput, 'End date cannot be before 1970');
                return false;
            }
        }
        if (startDateInput.value && endDateInput.value) {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            if (endDate <= startDate) {
                showError(endDateInput, 'End date must be after start date');
                return false;
            }
            const threeMonthsLater = new Date(startDate);
            threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 2);
            if (endDate < threeMonthsLater) {
                showError(endDateInput, 'Minimum 2 months gap required between start and end dates');
                return false;
            }
        }
        return true;
    }

    function setupEmploymentSection() {
        const addEmploymentBtn = document.getElementById('addEmploymentBtn');
        const employmentHistory = document.getElementById('employmentHistory');
        let employmentCounter = 1;
        const maxEmploymentEntries = 15;

        function checkEmploymentLimit() {
            const employmentRows = employmentHistory.querySelectorAll('.employment-row');
            if (employmentRows.length >= maxEmploymentEntries) {
                addEmploymentBtn.style.display = 'none';
            } else {
                addEmploymentBtn.style.display = 'block';
            }
        }

        addEmploymentBtn.addEventListener('click', function() {
            const employmentRows = employmentHistory.querySelectorAll('.employment-row');
            if (employmentRows.length >= maxEmploymentEntries) {
                showNotification('Maximum 15 employment entries allowed', 'error');
                return;
            }
            const newEmploymentRow = document.createElement('div');
            newEmploymentRow.classList.add('form-grid', 'employment-row', 'mt-4');
            newEmploymentRow.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Company Name</label>
                    <input type="text" name="employment[${employmentCounter}][companyName]" placeholder="Company Name">
                </div>
                <div class="form-group">
                    <label class="form-label">Designation/Role</label>
                    <input type="text" name="employment[${employmentCounter}][designation]" placeholder="Designation/Role">
                </div>
                <div class="form-group">
                    <label class="form-label">Last Project Name</label>
                    <input type="text" name="employment[${employmentCounter}][lastProject]" placeholder="Last Project Name">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" name="employment[${employmentCounter}][companyStartDate]" min="1970-01-01">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input type="date" name="employment[${employmentCounter}][companyEndDate]" min="1970-01-01">
                </div>
                <div class="form-group">
                    <label class="form-label">Experience Certificate</label>
                    <input type="file" name="employmentDocs" accept=".pdf,.jpg,.jpeg,.png">
                </div>
                <div class="file-format-info">Accepted formats: PDF, JPG, PNG (Max size: 2MB)</div>
                <div class="form-group">
                    <button type="button" class="remove-employment btn btn-danger w-50 mt-4">Remove</button>
                </div>
            `;
            employmentHistory.appendChild(newEmploymentRow);
            const startDateInput = newEmploymentRow.querySelector(`[name="employment[${employmentCounter}][companyStartDate]"]`);
            const endDateInput = newEmploymentRow.querySelector(`[name="employment[${employmentCounter}][companyEndDate]"]`);
            const today = new Date();
            const maxStartDate = new Date(today);
            maxStartDate.setMonth(today.getMonth() - 3);
            startDateInput.setAttribute('max', maxStartDate.toISOString().split('T')[0]);
            endDateInput.setAttribute('max', today.toISOString().split('T')[0]);
            const dateOfBirth = document.querySelector('input[name="dateOfBirth"]').value;
            if (dateOfBirth) {
                const birthDate = new Date(dateOfBirth);
                const minStartDate = new Date(birthDate);
                minStartDate.setFullYear(birthDate.getFullYear() + 10);
                startDateInput.setAttribute('min', minStartDate.toISOString().split('T')[0]);
            } else {
                startDateInput.setAttribute('min', '1970-01-01');
            }
            [startDateInput, endDateInput].forEach(dateInput => {
                dateInput.addEventListener('change', function() {
                    validateEmploymentDates(startDateInput, endDateInput);
                });
                dateInput.addEventListener('input', function() {
                    validateEmploymentDates(startDateInput, endDateInput);
                });
            });
            const dateOfBirthInput = document.querySelector('input[name="dateOfBirth"]');
            dateOfBirthInput.addEventListener('change', function() {
                if (this.value) {
                    const birthDate = new Date(this.value);
                    const minStartDate = new Date(birthDate);
                    minStartDate.setFullYear(birthDate.getFullYear() + 10);
                    startDateInput.setAttribute('min', minStartDate.toISOString().split('T')[0]);
                    validateEmploymentDates(startDateInput, endDateInput);
                }
            });
            const textInputs = newEmploymentRow.querySelectorAll('input[type="text"]');
            textInputs.forEach(input => {
                input.setAttribute('maxlength', '50');
                input.addEventListener('input', function(e) {
                    let value = e.target.value
                        .replace(/[^a-zA-Z\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trimStart();
                    const cleanValue = value.replace(/\s/g, '');
                    if (cleanValue.length > 50) {
                        let validValue = '';
                        let count = 0;
                        for (let char of value) {
                            if (char !== ' ' && count >= 50) continue;
                            if (char !== ' ') count++;
                            validValue += char;
                        }
                        e.target.value = validValue;
                    } else {
                        e.target.value = value;
                    }
                    validateFormField(input);
                });
            });
            newEmploymentRow.querySelector('.remove-employment').addEventListener('click', function() {
                newEmploymentRow.remove();
                checkEmploymentLimit();
            });
            const employmentStatus = document.getElementById('employmentStatus').value;
            if (employmentStatus === 'experienced') {
                textInputs.forEach(input => input.setAttribute('required', 'required'));
                startDateInput.setAttribute('required', 'required');
                endDateInput.setAttribute('required', 'required');
            }
            employmentCounter++;
            checkEmploymentLimit();
        });

        const initialStartDate = document.querySelector('[name="employment[0][companyStartDate]"]');
        const initialEndDate = document.querySelector('[name="employment[0][companyEndDate]"]');
        if (initialStartDate && initialEndDate) {
            const today = new Date();
            const maxStartDate = new Date(today);
            maxStartDate.setMonth(today.getMonth() - 3);
            initialStartDate.setAttribute('max', maxStartDate.toISOString().split('T')[0]);
            initialEndDate.setAttribute('max', today.toISOString().split('T')[0]);
            const dateOfBirth = document.querySelector('input[name="dateOfBirth"]').value;
            if (dateOfBirth) {
                const birthDate = new Date(dateOfBirth);
                const minStartDate = new Date(birthDate);
                minStartDate.setFullYear(birthDate.getFullYear() + 10);
                initialStartDate.setAttribute('min', minStartDate.toISOString().split('T')[0]);
            } else {
                initialStartDate.setAttribute('min', '1970-01-01');
            }
            [initialStartDate, initialEndDate].forEach(dateInput => {
                dateInput.addEventListener('change', function() {
                    validateEmploymentDates(initialStartDate, initialEndDate);
                });
                dateInput.addEventListener('input', function() {
                    validateEmploymentDates(initialStartDate, initialEndDate);
                });
            });
            const dateOfBirthInput = document.querySelector('input[name="dateOfBirth"]');
            dateOfBirthInput.addEventListener('change', function() {
                if (this.value) {
                    const birthDate = new Date(this.value);
                    const minStartDate = new Date(birthDate);
                    minStartDate.setFullYear(birthDate.getFullYear() + 10);
                    initialStartDate.setAttribute('min', minStartDate.toISOString().split('T')[0]);
                    validateEmploymentDates(initialStartDate, initialEndDate);
                }
            });
        }

        const initialTextInputs = employmentHistory.querySelectorAll('input[type="text"]');
        initialTextInputs.forEach(input => {
            input.setAttribute('maxlength', '50');
            input.addEventListener('input', function(e) {
                let value = e.target.value
                    .replace(/[^a-zA-Z\s]/g, '')
                    .replace(/\s+/g, ' ')
                    .trimStart();
                const cleanValue = value.replace(/\s/g, '');
                if (cleanValue.length > 50) {
                    let validValue = '';
                    let count = 0;
                    for (let char of value) {
                        if (char !== ' ' && count >= 50) continue;
                        if (char !== ' ') count++;
                        validValue += char;
                    }
                    e.target.value = validValue;
                } else {
                    e.target.value = value;
                }
                validateFormField(input);
            });
        });

        checkEmploymentLimit();
    }

    function setupFileUploadRestrictions() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(input => {
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                const maxSize = 2 * 1024 * 1024;
                const isSignatureFile = input.id === 'signatureFile';
                const validTypes = isSignatureFile 
                    ? ['image/jpeg', 'image/png'] 
                    : ['image/jpeg', 'image/png', 'application/pdf'];
                const errorMessage = isSignatureFile 
                    ? 'Invalid file type. Only JPG and PNG are allowed.' 
                    : 'Invalid file type. Only JPG, PNG, and PDF are allowed.';
                if (file) {
                    if (!validTypes.includes(file.type)) {
                        showError(input, errorMessage);
                        e.target.value = '';
                        return;
                    }
                    if (file.size > maxSize) {
                        showError(input, 'File size exceeds 2MB limit');
                        e.target.value = '';
                        return;
                    }
                    removeError(input);
                }
            });
        });
    }

    function validateFormField(input) {
        removeError(input);
        if (input.name.includes('employment') && (input.name.includes('companyStartDate') || input.name.includes('companyEndDate'))) {
            const row = input.closest('.employment-row');
            const startDateInput = row.querySelector('[name$="[companyStartDate]"]');
            const endDateInput = row.querySelector('[name$="[companyEndDate]"]');
            return validateEmploymentDates(startDateInput, endDateInput);
        }
        const dateOfBirth = document.querySelector('input[name="dateOfBirth"]').value;
        switch(input.name) {
            case 'fullName':
            case 'guardianName':
            case 'branchName':
            case 'employment[0][companyName]':
            case 'employment[1][companyName]':
            case 'employment[2][companyName]':
            case 'employment[3][companyName]':
            case 'employment[4][companyName]':
            case 'employment[5][companyName]':
            case 'employment[6][companyName]':
            case 'employment[7][companyName]':
            case 'employment[8][companyName]':
            case 'employment[9][companyName]':
            case 'employment[10][companyName]':
            case 'employment[11][companyName]':
            case 'employment[12][companyName]':
            case 'employment[13][companyName]':
            case 'employment[14][companyName]':
            case 'employment[0][designation]':
            case 'employment[1][designation]':
            case 'employment[2][designation]':
            case 'employment[3][designation]':
            case 'employment[4][designation]':
            case 'employment[5][designation]':
            case 'employment[6][designation]':
            case 'employment[7][designation]':
            case 'employment[8][designation]':
            case 'employment[9][designation]':
            case 'employment[10][designation]':
            case 'employment[11][designation]':
            case 'employment[12][designation]':
            case 'employment[13][designation]':
            case 'employment[14][designation]':
            case 'employment[0][lastProject]':
            case 'employment[1][lastProject]':
            case 'employment[2][lastProject]':
            case 'employment[3][lastProject]':
            case 'employment[4][lastProject]':
            case 'employment[5][lastProject]':
            case 'employment[6][lastProject]':
            case 'employment[7][lastProject]':
            case 'employment[8][lastProject]':
            case 'employment[9][lastProject]':
            case 'employment[10][lastProject]':
            case 'employment[11][lastProject]':
            case 'employment[12][lastProject]':
            case 'employment[13][lastProject]':
            case 'employment[14][lastProject]':
                if (!validations.validateAlphabeticField(input.value)) {
                    showError(input, 'Must be 5-50 alphabetic characters (including spaces)');
                    return false;
                }
                break;

            case 'education[0][stream]':
            case 'education[1][stream]':
            case 'education[2][stream]':
            case 'education[3][stream]':
            case 'education[4][stream]':
            case 'education[0][institution]':
            case 'education[1][institution]':
            case 'education[2][institution]':
            case 'education[3][institution]':
            case 'education[4][institution]':
                const cleanValue = input.value.replace(/\s/g, '');
                const trimmedValue = input.value.trim();
                const words = trimmedValue.split(/\s+/);
                const hasMultipleSpaces = /\s{2,}/.test(input.value);
                if (!trimmedValue) {
                    showError(input, 'This field cannot be empty or contain only spaces');
                    return false;
                }
                if (!/^[a-zA-Z\s]+$/.test(input.value)) {
                    showError(input, 'Only alphabetic characters and single spaces are allowed');
                    return false;
                }
                if (cleanValue.length < 3 || cleanValue.length > 50) {
                    showError(input, 'Must be 3-50 alphabetic characters (excluding spaces)');
                    return false;
                }
                if (hasMultipleSpaces) {
                    showError(input, 'Only single spaces are allowed between words');
                    return false;
                }
                break;

            case 'bankNameAsPerForm':
                if (!validations.validateAlphabeticField(input.value, 5, 50)) {
                    showError(input, 'Must be 5-50 alphabetic characters (including spaces)');
                    return false;
                }
                break;

            case 'currentCity':
            case 'permanentCity':
            case 'currentState':
            case 'permanentState':
                if (!validations.validateAlphabeticField(input.value, 3, 20)) {
                    showError(input, 'Must be 3-20 alphabetic characters (excluding spaces)');
                    return false;
                }
                break;

            case 'currentAddress':
            case 'permanentAddress':
                if (!validations.validateAddress(input.value)) {
                    showError(input, 'Must contain 5-100 chars, min 5 letters, single spaces only');
                    return false;
                }
                break;

            case 'email':
                if (!validations.validateEmail(input.value)) {
                    const localPart = input.value.split('@')[0] || '';
                    const domainPart = input.value.split('@')[1] || '';
                    const alphabeticCount = (localPart.match(/[a-zA-Z]/g) || []).length;
                    const validDomains = ['gmail.com', 'outlook.com'];
                    const atCount = (input.value.match(/@/g) || []).length;
                    const hasConsecutiveSpecialChars = /[\-_\.]{2}/.test(localPart);
                    if (atCount > 1) {
                        showError(input, 'Email must contain exactly one @ symbol');
                    } else if (atCount === 0 || !domainPart) {
                        showError(input, 'Email must include @ followed by gmail.com or outlook.com');
                    } else if (hasConsecutiveSpecialChars) {
                        showError(input, 'Email cannot contain consecutive -, _, or . characters');
                    } else if (alphabeticCount < 5) {
                        showError(input, 'Email must have at least 5 alphabetical characters before @');
                    } else if (!validDomains.includes(domainPart)) {
                        showError(input, 'Email must end with @gmail.com or @outlook.com');
                    } else if (!input.value.endsWith('.com')) {
                        showError(input, 'Email cannot have characters after .com');
                    } else if (/\s/.test(input.value)) {
                        showError(input, 'Email cannot contain spaces');
                    } else {
                        showError(input, 'Only letters, numbers, -, _, . are allowed, starting and ending with letter/number');
                    }
                    return false;
                }
                break;

            case 'phoneNo':
                const guardianContact = document.querySelector('input[name="guardianContact"]');
                if (!validations.validatePhoneNumber(input.value)) {
                    showError(input, 'Invalid phone number.');
                    return false;
                }
                if (guardianContact && guardianContact.value && !validations.validateDifferentPhone(input.value, guardianContact.value)) {
                    showError(input, 'Phone number cannot be the same as guardian contact');
                    return false;
                }
                break;

            case 'alternateNumber':
                if (input.value && !validations.validatePhoneNumber(input.value)) {
                    showError(input, 'Invalid phone number.');
                    return false;
                }
                break;
                
            case 'guardianContact':
                const phoneNo = document.querySelector('input[name="phoneNo"]');
                if (input.value && !validations.validatePhoneNumber(input.value)) {
                    showError(input, 'Invalid phone number.');
                    return false;
                }
                if (phoneNo && phoneNo.value && input.value && !validations.validateDifferentPhone(input.value, phoneNo.value)) {
                    showError(input, 'Guardian contact cannot be the same as phone number');
                    return false;
                }
                break;

            case 'aadharNo':
                if (!validations.validateAadharNumber(input.value)) {
                    showError(input, 'Must be 12 digits');
                    return false;
                }
                break;

            case 'panNo':
                if (!validations.validatePANNumber(input.value)) {
                    showError(input, 'Invalid PAN Number format');
                    return false;
                }
                break;

            case 'pfNo':
                if (input.value && !validations.validatePFNumber(input.value)) {
                    if (input.value.length < 13) {
                        showError(input, 'PF Number must be at least 13 characters long (5 letters + 8 digits)');
                    } else if (input.value.length > 22) {
                        showError(input, 'PF Number cannot exceed 22 characters (5 letters + 17 digits)');
                    } else if (!/^[A-Z]{5}/.test(input.value)) {
                        showError(input, 'First 5 characters must be uppercase letters');
                    } else if (!/^[A-Z]{5}\d{8,17}$/.test(input.value)) {
                        showError(input, 'After first 5 letters, only 8-17 digits allowed');
                    } else if (!/[1-9]/.test(input.value.slice(5))) {
                        showError(input, 'Digits cannot all be zeros');
                    } else {
                        showError(input, 'Invalid PF Number format (e.g., ABCDE12345678)');
                    }
                    return false;
                }
                break;

            case 'uanNo':
                if (input.value && !validations.validateUANNumber(input.value)) {
                    showError(input, 'UAN Number must be 12 digits starting with 1');
                    return false;
                }
                break;

            case 'currentPincode':
            case 'permanentPincode':
                if (!validations.validatePincode(input.value)) {
                    showError(input, 'Must be 6 digits');
                    return false;
                }
                break;

            case 'accountNo':
                if (!validations.validateAccountNumber(input.value)) {
                    showError(input, 'Account Number must be 8-18 digits and contain at least one non-zero digit');
                    return false;
                }
                break;

            case 'ifscCode':
                if (!validations.validateIFSCCode(input.value)) {
                    showError(input, 'Invalid IFSC Code format (Must be 11 characters, no spaces)');
                    return false;
                }
                break;

            case 'education[0][year]':
            case 'education[1][year]':
            case 'education[2][year]':
            case 'education[3][year]':
            case 'education[4][year]':
                if (!validations.validateGraduationYear(input.value, dateOfBirth)) {
                    const birthYear = dateOfBirth ? new Date(dateOfBirth).getFullYear() : 1970;
                    showError(input, `Invalid Graduation Year (must be 4 digits, ${birthYear + 10}-${new Date().getFullYear()})`);
                    return false;
                }
                break;

            case 'education[0][score]':
            case 'education[1][score]':
            case 'education[2][score]':
            case 'education[3][score]':
            case 'education[4][score]':
                if (!validations.validatePercentage(input.value)) {
                    showError(input, 'Percentage must be between 1-100');
                    return false;
                }
                break;

            case 'dateOfBirth':
                if (!input.value) {
                    showError(input, 'This field is required & Must be 21 years old');
                    return false;
                }
                if (!validations.validateAge(input.value)) {
                    showError(input, 'You must be at least 21 years old as of today');
                    return false;
                }
                const graduationYearInputs = document.querySelectorAll('input[name^="education["][name$="[year]"]');
                graduationYearInputs.forEach(yearInput => {
                    if (yearInput.value) {
                        validateFormField(yearInput);
                    }
                });
                break;
        }
        return true;
    }

    function setupFormSubmission() {
  const form = document.getElementById('onboardingForm');
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    let isValid = true;
    const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
    inputs.forEach(input => {
      if (!input.value.trim()) {
        showError(input, 'This field is required');
        isValid = false;
      } else if (!validateFormField(input)) {
        isValid = false;
      }
    });
    if (!validateGraduationYears()) {
      isValid = false;
    }
    const employmentStatus = document.getElementById('employmentStatus');
    const employmentHistorySection = document.getElementById('employmentHistorySection');
    if (!employmentStatus.value) {
      showError(employmentStatus, 'Please select an employment status');
      isValid = false;
    } else if (employmentStatus.value === 'experienced') {
      const employmentRows = employmentHistorySection.querySelectorAll('#employmentHistory .employment-row');
      if (employmentRows.length === 0) {
        showNotification('At least one employment history entry is required for experienced status', 'error');
        isValid = false;
      }
      employmentRows.forEach((row) => {
        const startDateInput = row.querySelector('[name$="[companyStartDate]"]');
        const endDateInput = row.querySelector('[name$="[companyEndDate]"]');
        if (!validateEmploymentDates(startDateInput, endDateInput)) {
          isValid = false;
        }
        const inputs = row.querySelectorAll('input:not([type="date"]):not([type="file"])');
        inputs.forEach(input => {
          if (!input.value.trim()) {
            showError(input, 'This field is required for experienced candidates');
            isValid = false;
          }
        });
        const employmentDoc = row.querySelector('[name="employmentDocs"]');
        if (!employmentDoc.files.length) {
          showError(employmentDoc, 'Please upload an experience certificate');
          isValid = false;
        }
      });
    }
    const signatureFile = document.getElementById('signatureFile');
    if (!signatureFile.files.length) {
      showError(signatureFile, 'Please upload a signature file');
      isValid = false;
    }
    // Validate education documents
    const educationRows = document.querySelectorAll('#educationContainer .education-row');
    educationRows.forEach((row, index) => {
      const educationDoc = row.querySelector('[name="educationDocs"]');
      if (!educationDoc.files.length) {
        showError(educationDoc, 'Please upload an education document');
        isValid = false;
      }
    });
    const consentCheckbox = document.getElementById('consentCheckbox');
    if (!consentCheckbox.checked) {
      showError(consentCheckbox, 'You must agree to the terms and conditions');
      isValid = false;
    }
    if (!isValid) {
      showNotification('Please fill the details properly', 'error');
      return;
    }
    const confirmSubmit = confirm('Are you sure you want to submit the onboarding form?');
    if (!confirmSubmit) {
      return; // Exit if user clicks "Cancel"
    }
    const formData = new FormData(form);
    const educationDetails = [];
    const employmentDetails = [];
    educationRows.forEach((row, index) => {
      const level = row.querySelector(`[name="education[${index}][level]"]`).value;
      const stream = row.querySelector(`[name="education[${index}][stream]"]`).value;
      const institution = row.querySelector(`[name="education[${index}][institution]"]`).value;
      const year = row.querySelector(`[name="education[${index}][year]"]`).value;
      const score = row.querySelector(`[name="education[${index}][score]"]`).value;
      const educationDoc = row.querySelector(`[name="educationDocs"]`).files[0];
      educationDetails.push({ level, stream, institution, year, score });
      if (educationDoc) formData.append('educationDocs', educationDoc);
    });
    const employmentStatusValue = employmentStatus.value || 'fresher';
    if (employmentStatusValue === 'experienced') {
      const employmentRows = employmentHistorySection.querySelectorAll('#employmentHistory .employment-row');
      employmentRows.forEach((row, index) => {
        const companyName = row.querySelector(`[name="employment[${index}][companyName]"]`).value;
        const designation = row.querySelector(`[name="employment[${index}][designation]"]`).value;
        const lastProject = row.querySelector(`[name="employment[${index}][lastProject]"]`).value;
        const companyStartDate = row.querySelector(`[name="employment[${index}][companyStartDate]"]`).value;
        const companyEndDate = row.querySelector(`[name="employment[${index}][companyEndDate]"]`).value;
        const employmentDoc = row.querySelector(`[name="employmentDocs"]`).files[0];
        employmentDetails.push({ companyName, designation, lastProject, companyStartDate, companyEndDate });
        if (employmentDoc) formData.append('employmentDocs', employmentDoc);
      });
    }
    formData.delete('employmentStatus');
    formData.append('employmentStatus', employmentStatusValue);
    formData.delete('educationDetails');
    formData.append('educationDetails', JSON.stringify(educationDetails));
    formData.delete('employmentDetails');
    formData.append('employmentDetails', JSON.stringify(employmentDetails));
    console.log('Submitting form data:');
    for (let [key, value] of formData.entries()) {
      console.log(`${key}:`, value);
    }
    try {
      const response = await fetch('http://52.91.6.56:3000/api/submit-onboarding', {
        method: 'POST',
        body: formData
      });
      const result = await response.json();
      if (!response.ok) {
        if (result.error.includes('already exists')) {
          const errorMessage = result.error;
          if (errorMessage.includes('Email ID')) showError(document.getElementById('email'), 'This email is already registered');
          if (errorMessage.includes('Phone Number')) showError(document.getElementById('phoneNo'), 'This phone number is already registered');
          if (errorMessage.includes('Aadhar Number')) showError(document.getElementById('aadharNo'), 'This Aadhar number is already registered');
          if (errorMessage.includes('PAN Number')) showError(document.getElementById('panNo'), 'This PAN number is already registered');
          if (errorMessage.includes('PF Number')) showError(document.getElementById('pfNo'), 'This PF number is already registered');
          if (errorMessage.includes('UAN Number')) showError(document.getElementById('uanNo'), 'This UAN number is already registered');
        }
        throw new Error(result.error || 'Submission failed');
      }
      showNotification('Form submitted successfully! Employee ID: ' + result.employeeId, 'success');
      form.reset();
      location.reload();
    } catch (error) {
      console.error('Submission error:', error);
      showNotification('Error submitting form: ' + error.message, 'error');
    }
  });
}

    function initializeForm() {
        const inputRestrictions = {
            'phoneNo': 10,
            'alternateNumber': 10,
            'guardianContact': 10,
            'aadharNo': 12,
            'panNo': 10,
            'currentPincode': 6,
            'permanentPincode': 6,
            'accountNo': 18,
            'fullName': 50,
            'guardianName': 50,
            'bankNameAsPerForm': 50,
            'currentCity': 20,
            'permanentCity': 20,
            'currentState': 20,
            'permanentState': 20,
            'uanNo': 12,
            'pfNo': 22,
            'ifscCode': 11,
            'branchName': 50,
            'email': 71
        };
        Object.entries(inputRestrictions).forEach(([name, maxLength]) => {
            const inputs = document.querySelectorAll(`input[name="${name}"]`);
            inputs.forEach(input => {
                input.setAttribute('maxlength', maxLength);
                input.addEventListener('input', function(e) {
                    if (['currentCity', 'permanentCity', 'currentState', 'permanentState'].includes(name)) {
                        let cleanValue = e.target.value
                            .replace(/[^a-zA-Z\s]/g, '')
                            .replace(/\s+/g, ' ')
                            .trimStart();
                        const charCount = cleanValue.replace(/\s/g, '').length;
                        if (charCount > maxLength) {
                            let validValue = '';
                            let count = 0;
                            for (let char of cleanValue) {
                                if (char !== ' ' && count >= maxLength) continue;
                                if (char !== ' ') count++;
                                validValue += char;
                            }
                            e.target.value = validValue;
                        } else {
                            e.target.value = cleanValue;
                        }
                    } else if (name === 'email') {
                        let value = e.target.value.replace(/[^a-zA-Z0-9@\-_.]/g, '');
                        const atCount = (value.match(/@/g) || []).length;
                        if (atCount > 1) {
                            const firstAtIndex = value.indexOf('@');
                            value = value.substring(0, firstAtIndex + 1) + value.substring(firstAtIndex + 1).replace(/@/g, '');
                        }
                        const atIndex = value.indexOf('@');
                        if (atIndex !== -1) {
                            let localPart = value.substring(0, atIndex);
                            let domainPart = value.substring(atIndex + 1);
                            let cleanLocalPart = '';
                            let lastChar = '';
                            for (let char of localPart) {
                                if (/[\-_\.]/.test(char) && /[\-_\.]/.test(lastChar)) {
                                    continue;
                                }
                                cleanLocalPart += char;
                                lastChar = char;
                            }
                            localPart = cleanLocalPart;
                            if (localPart.length > 50) {
                                localPart = localPart.substring(0, 50);
                            }
                            if (domainPart.startsWith('gmail.com')) {
                                domainPart = 'gmail.com';
                            } else if (domainPart.startsWith('outlook.com')) {
                                domainPart = 'outlook.com';
                            } else {
                                domainPart = domainPart.replace(/[^a-zA-Z.]/g, '').substring(0, 12);
                            }
                            value = localPart + '@' + domainPart;
                        } else {
                            let cleanValue = '';
                            let lastChar = '';
                            for (let char of value) {
                                if (/[\-_\.]/.test(char) && /[\-_\.]/.test(lastChar)) {
                                    continue;
                                }
                                cleanValue += char;
                                lastChar = char;
                            }
                            value = cleanValue;
                        }
                        e.target.value = value;
                        validateFormField(this);
                    } else if (name === 'panNo') {
                        e.target.value = e.target.value
                            .toUpperCase()
                            .replace(/[^A-Z0-9]/g, '')
                            .slice(0, maxLength);
                    } else if (name === 'pfNo' && e.target.value) {
                        let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                        if (value.length > 5) {
                            const letters = value.slice(0, 5).replace(/[^A-Z]/g, '');
                            const digits = value.slice(5).replace(/[^0-9]/g, '');
                            value = letters + digits;
                            if (value.length > maxLength) {
                                value = value.slice(0, maxLength);
                            }
                        } else {
                            value = value.replace(/[^A-Z]/g, '');
                        }
                        e.target.value = value;
                        validateFormField(this);
                    } else if (['phoneNo', 'alternateNumber', 'guardianContact', 'aadharNo', 'currentPincode', 'permanentPincode', 'accountNo', 'uanNo'].includes(name)) {
                        e.target.value = e.target.value.replace(/\D/g, '').slice(0, maxLength);
                    } else if (['fullName', 'guardianName', 'bankNameAsPerForm', 'branchName'].includes(name)) {
                        let cleanValue = e.target.value
                            .replace(/[^a-zA-Z\s]/g, '')
                            .replace(/\s+/g, ' ')
                            .trimStart();
                        if (cleanValue.length > maxLength) {
                            cleanValue = cleanValue.slice(0, maxLength);
                        }
                        e.target.value = cleanValue;
                    } else if (name === 'ifscCode') {
                        e.target.value = e.target.value
                            .toUpperCase()
                            .replace(/[^A-Z0-9]/g, '')
                            .slice(0, maxLength);
                    }
                    validateFormField(this);
                });
            });
        });
        const educationInputs = document.querySelectorAll('input[name$="[stream]"], input[name$="[institution]"]');
        educationInputs.forEach(input => {
            input.setAttribute('maxlength', '50');
            input.addEventListener('input', function(e) {
                let value = e.target.value
                    .replace(/[^a-zA-Z\s]/g, '')
                    .replace(/\s+/g, ' ')
                    .trimStart();
                const cleanValue = value.replace(/\s/g, '');
                if (cleanValue.length > 50) {
                    let validValue = '';
                    let count = 0;
                    for (let char of value) {
                        if (char !== ' ' && count >= 50) continue;
                        if (char !== ' ') count++;
                        validValue += char;
                    }
                    e.target.value = validValue;
                } else {
                    e.target.value = value;
                }
                validateFormField(this);
            });
        });
        const addressTextareas = document.querySelectorAll('textarea[name="currentAddress"], textarea[name="permanentAddress"]');
        addressTextareas.forEach(textarea => {
            textarea.addEventListener('input', function(e) {
                let value = e.target.value
                    .replace(/\s+/g, ' ')
                    .trimStart();
                const words = value.trim().split(' ');
                const previousWords = words.slice(0, -1);
                const hasSingleCharWords = previousWords.some(word => word.length === 1 && word !== '');
                if (hasSingleCharWords) {
                    e.target.value = e.target.dataset.previousValid || '';
                    validateFormField(this);
                    return;
                }
                const cleanValue = value.replace(/\s/g, '');
                if (cleanValue.length > 100) {
                    let validValue = '';
                    let count = 0;
                    for (let char of value) {
                        if (char !== ' ' && count >= 100) continue;
                        if (char !== ' ') count++;
                        validValue += char;
                    }
                    e.target.value = validValue;
                } else {
                    e.target.value = value;
                }
                if (validations.validateAddress(e.target.value)) {
                    e.target.dataset.previousValid = e.target.value;
                }
                validateFormField(this);
            });
        });
        const dateOfBirthInput = document.querySelector('input[name="dateOfBirth"]');
        const today = new Date();
        const maxDate = new Date(today);
        maxDate.setFullYear(today.getFullYear() - 21);
        dateOfBirthInput.setAttribute('max', maxDate.toISOString().split('T')[0]);
        dateOfBirthInput.addEventListener('change', function() {
            validateFormField(this);
        });
        const graduationYearInputs = document.querySelectorAll('input[name$="[year]"]');
        graduationYearInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
                validateFormField(this);
                validateGraduationYears();
            });
        });
        const percentageInputs = document.querySelectorAll('input[name$="[score]"]');
        percentageInputs.forEach(input => {
    input.addEventListener('input', function(e) {
        let value = e.target.value.replace(/[^0-9.]/g, ''); // Allow only digits and dot
        const parts = value.split('.');
        if (parts.length > 2) {
            value = parts[0] + '.' + parts[1]; // Keep only first dot
        }
        if (parts[0].length > 3) {
            parts[0] = parts[0].slice(0, 3); // Limit to 3 digits before decimal
            value = parts[0] + (parts[1] ? '.' + parts[1] : '');
        }
        if (parseInt(parts[0]) > 100) {
            parts[0] = '100'; // Cap at 100
            value = parts[0] + (parts[1] ? '.' + parts[1] : '');
        }
        if (parts[1] && parts[1].length > 2) {
            value = parts[0] + '.' + parts[1].slice(0, 2); // Limit to 2 decimal places
        }
        if (parts[0] === '' && parts[1]) {
            value = '0.' + parts[1]; // Handle .5 as 0.5
        }
        e.target.value = value;
        validateFormField(this);
    });
});
        const employmentStatus = document.getElementById('employmentStatus');
        const employmentHistorySection = document.getElementById('employmentHistorySection');
        employmentStatus.addEventListener('change', function() {
            removeError(this);
            if (this.value === 'experienced') {
                employmentHistorySection.style.display = 'block';
                const inputs = employmentHistorySection.querySelectorAll('input:not([type="file"])');
                inputs.forEach(input => {
                    input.setAttribute('required', 'required');
                    removeError(input);
                });
            } else {
                employmentHistorySection.style.display = 'none';
                const inputs = employmentHistorySection.querySelectorAll('input:not([type="file"])');
                inputs.forEach(input => {
                    input.removeAttribute('required');
                    removeError(input);
                });
            }
        });
        const consentCheckbox = document.getElementById('consentCheckbox');
        consentCheckbox.addEventListener('change', function() {
            if (this.checked) {
                removeError(this);
            } else {
                showError(this, 'You must agree to the terms and conditions');
            }
        });
    }

    setupAddressSynchronization();
    setupEducationSection();
    setupEmploymentSection();
    setupFileUploadRestrictions();
    setupFormSubmission();
    initializeForm();

    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (!input.name.includes('employment') || (!input.name.includes('companyStartDate') && !input.name.includes('companyEndDate'))) {
            input.addEventListener('input', function() {
                validateFormField(this);
            });
            input.addEventListener('change', function() {
                validateFormField(this);
            });
        }
    });
});
    </script>
</body>
</html>
